# 视频预览压缩脚本使用说明

## 功能描述
`compress_preview_videos.py` 脚本用于处理 `static/video` 目录中的视频文件，截取前15秒并压缩以适合主页展示使用。

## 主要特性
- ✂️ **截取前15秒**：自动截取视频的前15秒（如果视频不足15秒则使用全部时长）
- 🗜️ **智能压缩**：保持720p分辨率，优化比特率和编码参数
- 📁 **批量处理**：一次性处理目录中的所有视频文件
- 🚀 **Web优化**：添加faststart标记，优化web播放加载速度
- 📊 **详细统计**：显示处理进度和压缩效果

## 压缩效果
根据测试结果，脚本能够实现非常高的压缩率：

| 原始文件 | 原始大小 | 压缩后大小 | 压缩率 | 时长 |
|---------|---------|-----------|-------|------|
| 讲经.mp4 | 18.8MB | 0.7MB | 96.4% | 15秒 |
| 读一本书.mp4 | 11.3MB | 0.6MB | 94.3% | 15秒 |
| 通用.mp4 | 3.5MB | 0.3MB | 91.7% | 15秒 |
| 故事.mp4 | 17.7MB | 1.0MB | 94.4% | 15秒 |

## 使用方法

### 基本用法
```bash
# 在项目根目录运行
python compress_preview_videos.py
```

### 技术参数
- **输入目录**：`static/video/`
- **输出目录**：`static/video/preview/`
- **截取时长**：15秒
- **目标分辨率**：最大720p
- **视频编码**：H.264 (libx264)
- **音频编码**：AAC
- **视频比特率**：1Mbps
- **音频比特率**：128kbps
- **帧率**：24fps
- **质量因子**：CRF 28

## 文件结构
```
static/video/
├── 原始视频文件.mp4
├── preview/
│   ├── 原始视频文件_preview.mp4
│   └── ...
```

## 依赖要求
- Python 3.6+
- moviepy
- ffmpeg (moviepy的依赖)

## 安装依赖
```bash
pip install moviepy
```

## 注意事项
1. **重复运行安全**：脚本会检查输出文件是否已存在，避免重复处理
2. **支持格式**：支持 MP4, AVI, MOV, MKV, WMV, FLV 格式
3. **内存使用**：处理大文件时可能占用较多内存
4. **处理时间**：取决于视频大小和计算机性能

## 自定义配置
如需修改默认参数，可以编辑脚本中的以下变量：
- `duration`：截取时长（秒）
- `target_height`：目标分辨率高度
- `bitrate`：视频比特率
- `audio_bitrate`：音频比特率
- `fps`：输出帧率

## 错误处理
脚本包含完整的错误处理机制：
- 自动跳过已存在的输出文件
- 显示详细的错误信息
- 支持 Ctrl+C 中断操作
- 处理单个文件失败不会影响其他文件

## 示例输出
```
============================================================
视频预览处理脚本
============================================================
功能: 截取视频前15秒并压缩以适合主页展示

找到 4 个视频文件
开始处理...

[1/4] 处理: 通用.mp4
  📹 原始时长: 176.1秒, 分辨率: 1280x720
  💾 正在保存: static/video/preview/通用_preview.mp4
  ✅ 完成! 时长: 15.0秒
     原始大小: 3.5MB → 压缩后: 0.3MB
     压缩率: 91.7%

🎉 所有视频处理完成!
```
