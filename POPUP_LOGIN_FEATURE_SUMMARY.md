# å¼¹çª—ç™»å½•åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ç”¨æˆ·å‹å¥½çš„å¼¹çª—ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½ï¼Œé¿å…ç”¨æˆ·åœ¨ç”Ÿæˆè§†é¢‘æ—¶è·³è½¬é¡µé¢ä¸¢å¤±è¾“å…¥çš„æç¤ºè¯ã€‚

## ğŸ”§ ä¸»è¦å˜æ›´

### 1. å‰ç«¯ä¿®æ”¹ (templates/index.html)

#### 1.1 æ·»åŠ å¼¹çª—ç»„ä»¶
- **ç™»å½•å¼¹çª—**: åŒ…å«ç”¨æˆ·åã€å¯†ç è¾“å…¥æ¡†å’Œç™»å½•æŒ‰é’®
- **æ³¨å†Œå¼¹çª—**: åŒ…å«ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç è¾“å…¥æ¡†å’Œæ³¨å†ŒæŒ‰é’®
- **å¼¹çª—åˆ‡æ¢**: ç™»å½•å’Œæ³¨å†Œå¼¹çª—å¯ä»¥ç›¸äº’åˆ‡æ¢

#### 1.2 Vue.js æ•°æ®ç»“æ„æ›´æ–°
```javascript
data() {
    return {
        // åŸæœ‰æ•°æ®...
        showLoginDialog: false,        // æ§åˆ¶ç™»å½•å¼¹çª—æ˜¾ç¤º
        showRegisterDialog: false,     // æ§åˆ¶æ³¨å†Œå¼¹çª—æ˜¾ç¤º
        loginForm: {                   // ç™»å½•è¡¨å•æ•°æ®
            username: '',
            password: ''
        },
        registerForm: {                // æ³¨å†Œè¡¨å•æ•°æ®
            username: '',
            email: '',
            password: ''
        },
        loginLoading: false,           // ç™»å½•æŒ‰é’®åŠ è½½çŠ¶æ€
        registerLoading: false,        // æ³¨å†ŒæŒ‰é’®åŠ è½½çŠ¶æ€
        savedPrompt: '',               // ä¿å­˜çš„æç¤ºè¯
    };
}
```

#### 1.3 æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•
- `handleLogin()`: å¤„ç†ç™»å½•é€»è¾‘
- `handleRegister()`: å¤„ç†æ³¨å†Œé€»è¾‘
- `updateUserInfo()`: æ›´æ–°å…¨å±€ç”¨æˆ·ä¿¡æ¯
- `openLoginDialog()`: æ‰“å¼€ç™»å½•å¼¹çª—
- `openRegisterDialog()`: æ‰“å¼€æ³¨å†Œå¼¹çª—
- `handleForgotPassword()`: å¤„ç†å¿˜è®°å¯†ç 

#### 1.4 æµç¨‹ä¼˜åŒ–
- ç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"æ—¶ï¼Œå¦‚æœæœªç™»å½•ï¼Œä¿å­˜å½“å‰è¾“å…¥çš„æç¤ºè¯åˆ° `savedPrompt`
- ç™»å½•æˆ–æ³¨å†ŒæˆåŠŸåï¼Œè‡ªåŠ¨æ¢å¤ `savedPrompt` åˆ°è¾“å…¥æ¡†
- å¼¹çª—å…³é—­åæ¸…ç©ºè¡¨å•æ•°æ®

### 2. åç«¯ä¿®æ”¹ (app.py)

#### 2.1 ç™»å½•è·¯ç”±å¢å¼º
```python
@app.route('/login', methods=['GET', 'POST'])
def login():
    # æ”¯æŒè¡¨å•æ•°æ®å’ŒJSONæ•°æ®
    if request.content_type == 'application/json':
        data = request.get_json()
        username = data.get('username')
        password = data.get('password')
    else:
        username = request.form.get('username')
        password = request.form.get('password')
    
    # ç™»å½•æˆåŠŸåè¿”å›ç”¨æˆ·ä¿¡æ¯
    if request.content_type == 'application/json':
        return jsonify({
            'success': True,
            'message': 'ç™»å½•æˆåŠŸ',
            'user': {
                'id': user.id,
                'username': user.username,
                'email': user.email,
                'isAuthenticated': True,
                'isVip': user.is_vip,
                'credits': user.credits,
                'vipExpireAt': user.vip_expire_at.isoformat() if user.vip_expire_at else None
            }
        })
```

#### 2.2 æ³¨å†Œè·¯ç”±å¢å¼º
```python
@app.route('/register', methods=['GET', 'POST'])
def register():
    # æ”¯æŒè¡¨å•æ•°æ®å’ŒJSONæ•°æ®
    if request.content_type == 'application/json':
        data = request.get_json()
        username = data.get('username')
        email = data.get('email')
        password = data.get('password')
    else:
        username = request.form.get('username')
        email = request.form.get('email')
        password = request.form.get('password')
    
    # æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•å¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯
    if request.content_type == 'application/json':
        return jsonify({
            'success': True,
            'message': 'æ³¨å†ŒæˆåŠŸ',
            'user': {
                'id': user.id,
                'username': user.username,
                'email': user.email,
                'isAuthenticated': True,
                'isVip': user.is_vip,
                'credits': user.credits,
                'vipExpireAt': user.vip_expire_at.isoformat() if user.vip_expire_at else None
            }
        })
```

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### 1. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… å¼¹çª—ç™»å½•ï¼Œä¸è·³è½¬é¡µé¢
- âœ… ä¿æŒè¾“å…¥æ¡†å†…å®¹ä¸ä¸¢å¤±
- âœ… æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•
- âœ… ç™»å½•/æ³¨å†Œå¼¹çª—å¯ç›¸äº’åˆ‡æ¢
- âœ… æ”¯æŒå¿˜è®°å¯†ç åŠŸèƒ½

### 2. æŠ€æœ¯å®ç°
- âœ… æ”¯æŒJSONå’Œè¡¨å•ä¸¤ç§æ•°æ®æ ¼å¼
- âœ… ä¿æŒåŸæœ‰é¡µé¢è·³è½¬åŠŸèƒ½å…¼å®¹
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å…¨å±€ç”¨æˆ·çŠ¶æ€ç®¡ç†

### 3. å®‰å…¨æ€§
- âœ… ä¿æŒåŸæœ‰å¯†ç éªŒè¯é€»è¾‘
- âœ… ç”¨æˆ·ååˆæ³•æ€§æ ¡éªŒ
- âœ… é‡å¤ç”¨æˆ·å/é‚®ç®±æ£€æŸ¥
- âœ… ç™»å½•æ—¥å¿—è®°å½•

## ğŸš€ ä½¿ç”¨æµç¨‹

### åœºæ™¯1: æœªç™»å½•ç”¨æˆ·ç”Ÿæˆè§†é¢‘
1. ç”¨æˆ·åœ¨é¦–é¡µè¾“å…¥æç¤ºè¯
2. ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"æŒ‰é’®
3. ç³»ç»Ÿæ£€æµ‹åˆ°æœªç™»å½•ï¼Œå¼¹å‡ºç™»å½•å¼¹çª—
4. ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç‚¹å‡»ç™»å½•
5. ç™»å½•æˆåŠŸåï¼Œå¼¹çª—å…³é—­ï¼Œè¾“å…¥æ¡†å†…å®¹ä¿æŒä¸å˜
6. ç”¨æˆ·å¯ä»¥ç»§ç»­ç”Ÿæˆè§†é¢‘

### åœºæ™¯2: æ–°ç”¨æˆ·æ³¨å†Œ
1. ç”¨æˆ·åœ¨ç™»å½•å¼¹çª—ä¸­ç‚¹å‡»"ç«‹å³æ³¨å†Œ"
2. å¼¹å‡ºæ³¨å†Œå¼¹çª—
3. ç”¨æˆ·å¡«å†™æ³¨å†Œä¿¡æ¯ï¼Œç‚¹å‡»æ³¨å†Œ
4. æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨ç™»å½•ï¼Œå¼¹çª—å…³é—­
5. è¾“å…¥æ¡†å†…å®¹ä¿æŒä¸å˜

### åœºæ™¯3: å¼¹çª—é—´åˆ‡æ¢
1. åœ¨ç™»å½•å¼¹çª—ä¸­ç‚¹å‡»"ç«‹å³æ³¨å†Œ" â†’ åˆ‡æ¢åˆ°æ³¨å†Œå¼¹çª—
2. åœ¨æ³¨å†Œå¼¹çª—ä¸­ç‚¹å‡»"ç«‹å³ç™»å½•" â†’ åˆ‡æ¢åˆ°ç™»å½•å¼¹çª—
3. åœ¨ç™»å½•å¼¹çª—ä¸­ç‚¹å‡»"å¿˜è®°å¯†ç " â†’ æ–°çª—å£æ‰“å¼€å¿˜è®°å¯†ç é¡µé¢

## ğŸ“ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `templates/index.html`: å‰ç«¯å¼¹çª—ç•Œé¢å’Œé€»è¾‘
- `app.py`: åç«¯ç™»å½•å’Œæ³¨å†Œè·¯ç”±

### æµ‹è¯•æ–‡ä»¶
- `test_popup_login.py`: åŠŸèƒ½æµ‹è¯•è„šæœ¬

## ğŸ” æµ‹è¯•è¯´æ˜

### è‡ªåŠ¨æµ‹è¯•
```bash
# å¯åŠ¨åº”ç”¨
python run.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
python test_popup_login.py
```

### æ‰‹åŠ¨æµ‹è¯•
1. è®¿é—® http://localhost:5002
2. è¾“å…¥ä¸€äº›æç¤ºè¯
3. ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"æŒ‰é’®
4. éªŒè¯å¼¹çª—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
5. æµ‹è¯•ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½
6. éªŒè¯è¾“å…¥æ¡†å†…å®¹æ˜¯å¦ä¿æŒ

## ğŸ¨ æ ·å¼è¯´æ˜

å¼¹çª—é‡‡ç”¨æ·±è‰²ä¸»é¢˜ï¼Œä¸ç½‘ç«™æ•´ä½“é£æ ¼ä¿æŒä¸€è‡´ï¼š
- èƒŒæ™¯è‰²ï¼š`#1e293b`
- è¾¹æ¡†è‰²ï¼š`#334155`
- è¾“å…¥æ¡†èƒŒæ™¯ï¼š`#334155`
- ä¸»è‰²è°ƒï¼š`#3b82f6`ï¼ˆè“è‰²ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å…¼å®¹æ€§**: ä¿æŒäº†åŸæœ‰è¡¨å•æäº¤æ–¹å¼çš„å…¼å®¹æ€§
2. **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ `window.AppConfig.globalData` ç®¡ç†ç”¨æˆ·çŠ¶æ€
3. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯æç¤ºæœºåˆ¶
4. **å®‰å…¨æ€§**: ä¿æŒäº†åŸæœ‰çš„æ‰€æœ‰å®‰å…¨éªŒè¯é€»è¾‘

## ğŸ”§ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: å¯ä»¥è€ƒè™‘æ·»åŠ é˜²æŠ–åŠŸèƒ½ï¼Œé¿å…é‡å¤æäº¤
2. **ç”¨æˆ·ä½“éªŒ**: å¯ä»¥æ·»åŠ è®°ä½å¯†ç åŠŸèƒ½
3. **å›½é™…åŒ–**: æ”¯æŒå¤šè¯­è¨€æç¤ºä¿¡æ¯
4. **ç§»åŠ¨ç«¯**: ä¼˜åŒ–ç§»åŠ¨ç«¯å¼¹çª—æ˜¾ç¤ºæ•ˆæœ

---

**å®ç°æ—¶é—´**: 2025-07-16  
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: ğŸ”„ å¾…éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ